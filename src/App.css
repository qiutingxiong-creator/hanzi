import React, { useState, useRef, useEffect, useMemo } from 'react';
import { Search, Volume2, BookOpen, PenTool, Edit3, Trash2, Settings, Cloud, Loader2, X, ChevronRight, PlusCircle, Save, Play, ChevronDown, RefreshCcw } from 'lucide-react';

// ==========================================
// 1. å®Œæ•´åŸå§‹æ•°æ®æº (å·²åˆå¹¶ï¼Œæ— éœ€é¢å¤–æ–‡ä»¶)
// ==========================================
const RAW_DATA_SOURCE = `
çˆ±	Ã i	7	1
å§	ba	10	2
å¸®	bÄng	12	2
åŒ…	bÄo	5	2
å®	bÇo	7	2
æœ¬	bÄ›n	2	2
ç¬”	bÇ	2	2
åˆ«	biÃ©	6	2
ä¸	bÃ¹	2	2
é•¿	chÃ¡ng	11	2
å”±	chÃ ng	5	2
ä»	cÃ³ng	11	2
è›‹	dÃ n	5	2
åœ°	dÃ¬	8	2
å¾—	de	7	2
ç‚¹	diÇn	12	2
åŠ¨	dÃ²ng	9	2
éƒ½	dÅu	8	2
è¯»	dÃº	1	2
å¯¹	duÃ¬	4	2
é¥¿	Ã¨	6	2
å‘	fÄ	10	2
æˆ¿	fÃ¡ng	6	2
æ”¾	fÃ ng	3	2
é£	fÄ“i	9	2
å‘Š	gÃ o	3	2
å“¥	gÄ“	1	2
ç»™	gÄ›i	5	2
è·Ÿ	gÄ“n	8	2
å·¥	gÅng	â€”	2
å…¬	gÅng	â€”	2
å¤	gÇ”	â€”	2
ç“œ	guÄ	â€”	2
å…³	guÄn	â€”	2
å…‰	guÄng	9	2
å›½	guÃ³	11	2
æœ	guÇ’	5	2
è¿˜	hÃ¡i	6	2
å­©	hÃ¡i	4	2
æµ·	hÇi	12	2
æ±‰	hÃ n	1	2
æ²³	hÃ©	9	2
å¾ˆ	hÄ›n	8	2
æ¹–	hÃº	9	2
å	huÃ¡	11	2
ç”»	huÃ 	1	2
æ¬¢	huÄn	1	2
ä¼š	huÃ¬	6	2
æ´»	huÃ³	12	2
è®°	jÃ¬	4	2
å‡	jiÇ	12	2
é—´	jiÄn	6	2
ä»¶	jiÃ n	7	2
æ±Ÿ	jiÄng	â€”	2
è®²	jiÇng	2	2
æ•™	jiÄo	1	2
æ•™	jiÃ o	2	2
å§	jiÄ›	â€”	2
ä»Š	jÄ«n	3	2
å…·	jÃ¹	â€”	2
è§‰	juÃ©	â€”	2
å¡	kÇ	5	2
è€ƒ	kÇo	7	2
å¯	kÄ›	6	2
å¿«	kuÃ i	12	2
ä¹	lÃ¨	12	2
é‡Œ	lÇ	2	2
ä¸¤	liÇng	7	2
äº®	liÃ ng	8	2
æµ	liÃº	9	2
æ—…	lÇš	12	2
å—	ma	2	2
ä¹°	mÇi	5	2
ä¹ˆ	me	8	2
æ²¡	mÃ©i	4	2
è‹—	miÃ¡o	10	2
å	mÃ­ng	11	2
æ˜	mÃ­ng	â€”	2
æ¯	mÇ”	11	2
å“ª	nÇ	8	2
é‚£	nÃ 	2	2
è„‘	nÇo	7	2
æœŸ	qÄ«	3	2
èµ·	qÇ	4	2
äº²	qÄ«n	11	2
è¯·	qÇng	4	2
è°	shuÃ­	3	2
ä»€	shÃ©n	8	2
æ—¶	shÃ­	9	2
æ‹¾	shÃ­	6	2
äº‹	shÃ¬	6	2
å®¤	shÃ¬	2	2
æ”¶	shÅu	6	2
ä¹¦	shÅ«	2	2
æ ‘	shÃ¹	10	2
åŒ	shuÄng	7	2
æ€	sÄ«	7	2
è¯‰	sÃ¹	3	2
å²	suÃ¬	5	2
å®ƒ	tÄ	11	2
å¥¹	tÄ	2	2
æ¡	tiÃ¡o	11	2
å¬	tÄ«ng	3	2
ç©	wÃ¡n	5	2
ä¸‡	wÃ n	7	2
ä¸º	wÃ©i	8	2
é—®	wÃ¨n	3	2
åˆ	wÇ”	3	2
åŠ¡	wÃ¹	12	2
ç‰©	wÃ¹	12	2
æ´—	xÇ	6	2
å–œ	xÇ	1	2
ç³»	xÃ¬	4	2
æƒ³	xiÇng	9	2
å†™	xiÄ›	1	2
è°¢	xiÃ¨	4	2
å¿ƒ	xÄ«n	3	2
æ˜Ÿ	xÄ«ng	3	2
èŠ½	yÃ¡	10	2
æ´‹	yÃ¡ng	12	2
è¦	yÃ o	10	2
ä¹Ÿ	yÄ›	8	2
å¤œ	yÃ¨	9	2
ä»¥	yÇ	12	2
æ³³	yÇ’ng	2	2
ç”¨	yÃ²ng	4	2
æ¸¸	yÃ³u	9	2
å‹	yÇ’u	3	2
åˆ	yÃ²u	7	2
è¯­	yÇ”	1	2
è¿œ	yuÇn	8	2
åœ¨	zÃ i	1	2
å†	zÃ i	4	2
å¼ 	zhÄng	5	2
é•¿	zhÇng	9	2
ç€	zhe	11	2
ç§	zhÇ’ng	10	2
ç§	zhÃ²ng	10	2
å­	zÇ	2	2
å­—	zÃ¬	1	2
æœ€	zuÃ¬	11	2
æ˜¨	zuÃ³	5	2
ä½œ	zuÃ²	7	2
åš	zuÃ²	4	2
çˆ±	Ã i	7	1
å…«	bÄ	1	1
çˆ¸	bÃ 	9	1
ç™½	bÃ¡i	6	1
ç™¾	bÇi	1	1
åŒ—	bÄ›i	11	1
è‰	cÇo	6	1
è½¦	chÄ“	8	1
è™«	chÃ³ng	6	1
å‡º	chÅ«	4	1
ç©¿	chuÄn	12	1
æ˜¥	chÅ«n	5	1
å¤§	dÃ 	2	1
æˆ´	dÃ i	12	1
åˆ°	dÃ o	12	1
çš„	de	9	1
åœ°	dÃ¬	5	1
ç”µ	diÃ n	5	1
ä¸œ	dÅng	11	1
å†¬	dÅng	5	1
å¤š	duÅ	2	1
å„¿	Ã©r	10	1
è€³	Ä›r	2	1
äºŒ	Ã¨r	1	1
æ–¹	fÄng	11	1
é£	fÄ“ng	â€”	1
é«˜	gÄo	8	1
ä¸ª	gÃ¨	10	1
å¥½	hÇo	8	1
ç¦¾	hÃ©	3	1
å’Œ	hÃ©	9	1
é»‘	hÄ“i	6	1
çº¢	hÃ³ng	6	1
å	hÃ²u	â€”	1
èŠ±	huÄ	10	1
é»„	huÃ¡ng	6	1
ç«	huÇ’	3	1
å­£	jÃ¬	10	1
å®¶	jiÄ	9	1
è§	jiÃ n	8	1
ä¹	jiÇ”	1	1
å¼€	kÄi	8	1
çœ‹	kÃ n	10	1
å£	kÇ’u	2	1
æ¥	lÃ¡i	4	1
è“	lÃ¡n	6	1
è€	lÇo	7	1
äº†	le	8	1
ç«‹	lÃ¬	4	1
å…­	liÃ¹	1	1
ç»¿	lÇœ	6	1
å¦ˆ	mÄ	9	1
é©¬	mÇ	6	1
å¸½	mÃ o	12	1
é—¨	mÃ©n	10	1
ä»¬	men	8	1
é¢	miÃ n	11	1
æœ¨	mÃ¹	3	1
ç›®	mÃ¹	2	1
å¥¶	nÇi	9	1
å—	nÃ¡n	11	1
é—¹	nÃ o	12	1
ä½ 	nÇ	8	1
å¹´	niÃ¡n	10	1
é¸Ÿ	niÇo	6	1
ç‰›	niÃº	6	1
ä¸ƒ	qÄ«	1	1
å‰	qiÃ¡n	10	1
ç§‹	qiÅ«	5	1
å»	qÃ¹	4	1
çƒ­	rÃ¨	12	1
äºº	rÃ©n	2	1
è®¤	rÃ¨n	11	1
æ—¥	rÃ¬	3	1
å…¥	rÃ¹	4	1
ä¸‰	sÄn	1	1
å±±	shÄn	3	1
ä¸Š	shÃ ng	4	1
å°‘	shÇo	2	1
èº«	shÄ“n	12	1
ç”Ÿ	shÄ“ng	7	1
å¸ˆ	shÄ«	7	1
å	shÃ­	1	1
çŸ³	shÃ­	3	1
è¯´	shuÅ	8	1
å››	sÃ¬	1	1
æ˜¯	shÃ¬	7	1
æ‰‹	shÇ’u	2	1
æ°´	shuÇ	3	1
ä»–	tÄ	10	1
å¤ª	tÃ i	11	1
ä½“	tÇ	12	1
å¤©	tiÄn	5	1
ç”°	tiÃ¡n	3	1
åŒ	tÃ³ng	7	1
å¤´	tÃ³u	2	1
åœŸ	tÇ”	3	1
å¤–	wÃ i	10	1
æ–‡	wÃ©n	7	1
æˆ‘	wÇ’	7	1
äº”	wÇ”	1	1
è¥¿	xÄ«	11	1
ä¹ 	xÃ­	12	1
ä¸‹	xiÃ 	4	1
å¤	xiÃ 	5	1
å‘	xiÃ ng	11	1
æ ¡	xiÃ o	7	1
æ–°	xÄ«n	12	1
å…´	xÃ¬ng	8	1
å­¦	xuÃ©	7	1
é›ª	xuÄ›	5	1
ç¾Š	yÃ¡ng	6	1
çˆ·	yÃ©	9	1
ä¸€	yÄ«	1	1
è¡£	yÄ«	12	1
æœ‰	yÇ’u	9	1
å³	yÃ²u	4	1
é±¼	yÃº	6	1
é›¨	yÇ”	5	1
å›­	yuÃ¡n	10	1
æœˆ	yuÃ¨	2	1
äº‘	yÃºn	5	1
æ—©	zÇo	8	1
è¿™	zhÃ¨	9	1
çœŸ	zhÄ“n	8	1
ä¸­	zhÅng	4	1
ç¥	zhÃ¹	12	1
èµ°	zÇ’u	4	1
è¶³	zÃº	2	1
å·¦	zuÇ’	4	1
å	zuÃ²	4	1
æŠŠ	bÇ	9	3
æŠ¥	bÃ o	2	3
è¢«	bÃ¨i	12	3
é¼»	bÃ­	4	3
è¾¹	biÄn	4	3
å˜	biÃ n	5	3
ä¾¿	biÃ n	9	3
ç—…	bÃ¬ng	3	3
å¸ƒ	bÃ¹	9	3
æ­¥	bÃ¹	10	3
çŒœ	cÄi	4	3
é‡‡	cÇi	4	3
å±‚	cÃ©ng	7	3
å°	chÃ¡ng	6	3
å¸¸	chÃ¡ng	8	3
æˆ	chÃ©ng	5	3
åƒ	chÄ«	2	3
å†²	chÅng	8	3
ä¼ 	chuÃ¡n	4	3
åºŠ	chuÃ¡ng	7	3
æ‰“	dÇ	9	3
ä»£	dÃ i	9	3
å¸¦	dÃ i	3	3
é“	dÃ o	1	3
å¾—	dÃ©	10	3
ç¯	dÄ“ng	1	3
ç­‰	dÄ›ng	2	3
ä½	dÄ«	7	3
å¼Ÿ	dÃ¬	1	3
ç¬¬	dÃ¬	10	3
åº—	diÃ n	2	3
é’“	diÃ o	11	3
æ‰	diÃ o	5	3
åŠ¨	dÃ²ng	4	3
æœµ	duÇ’	4	3
é¥­	fÃ n	2	3
ç²‰	fÄ›n	4	3
ä»˜	fÃ¹	2	3
ç›–	gÃ i	8	3
å¹²	gÄn	9	3
æ„Ÿ	gÇn	3	3
å¹²	gÃ n	12	3
æ ¹	gÄ“n	12	3
æ›´	gÃ¨ng	7	3
ç‹—	gÇ’u	6	3
æ•…	gÃ¹	2	3
æ€ª	guÃ i	8	3
é¾Ÿ	guÄ«	10	3
è¿‡	guÃ²	6	3
å–Š	hÇn	12	3
å€™	hÃ²u	5	3
å£¶	hÃº	8	3
æŠ¤	hÃ¹	3	3
è¯	huÃ 	2	3
è°	huÇng	12	3
å›	huÃ­	10	3
æœº	jÄ«	8	3
å‡ 	jÇ	11	3
å·²	yÇ	6	3
äº¤	jiÄo	1	3
è§‰	juÃ©	5	3
è¡—	jiÄ“	1	3
ç»“	jiÃ©	11	3
ç»	jÄ«ng	11	3
æ™´	qÃ­ng	4	3
é™	jÃ¬ng	7	3
å°±	jiÃ¹	3	3
ä¸¾	jÇ”	7	3
å†³	juÃ©	9	3
ç§‘	kÄ“	8	3
åˆ»	kÃ¨	12	3
è¯¾	kÃ¨	2	3
å®½	kuÄn	1	3
æ‹‰	lÄ	1	3
ç‹ 	hÄ›n	12	3
åŠ³	lÃ¡o	4	3
å†·	lÄ›ng	5	3
ç†	lÇ	2	3
å‡‰	liÃ¡ng	6	3
é‡	liÃ ng	3	3
æ¥¼	lÃ³u	7	3
æ»¡	mÇn	6	3
æ…¢	mÃ n	10	3
å¿™	mÃ¡ng	1	3
çŒ«	mÄo	6	3
å†’	mÃ o	3	3
å¦¹	mÃ¨i	1	3
èœœ	mÃ¬	4	3
æ‹¿	nÃ¡	2	3
å‘¢	ne	2	3
èƒ½	nÃ©ng	1	3
å¼„	nÃ²ng	12	3
çˆ¬	pÃ¡	10	3
è·‘	pÇo	5	3
çš®	pÃ­	9	3
ç‰‡	piÃ n	9	3
éª—	piÃ n	12	3
é£˜	piÄo	5	3
ç ´	pÃ²	9	3
æ¬º	qÄ«	12	3
æ°”	qÃ¬	8	3
æ±½	qÃ¬	5	3
åƒ	qiÄn	7	3
é’±	qiÃ¡n	2	3
ç„¶	rÃ¡n	10	3
è®©	rÃ ng	8	3
ä»	rÃ©ng	10	3
æ’’	sÄ	12	3
çƒ§	shÄo	3	3
å£°	shÄ“ng	12	3
è¯—	shÄ«	7	3
å£«	shÃ¬	3	3
èµ›	sÃ i	10	3
è¯•	shÃ¬	8	3
é¦–	shÇ’u	7	3
ç¡	shuÃ¬	5	3
ç³–	tÃ¡ng	6	3
ç”œ	tiÃ¡n	6	3
è·³	tiÃ o	5	3
åœ	tÃ­ng	1	3
é€š	tÅng	1	3
ç«¥	tÃ³ng	2	3
å…”	tÃ¹	6	3
å¾€	wÇng	1	3
æœ›	wÃ ng	7	3
ä½	wÃ¨i	8	3
æ¸©	wÄ“n	3	3
ä¹Œ	wÅ«	10	3
å’¸	xiÃ¡n	6	3
ç°	xiÃ n	2	3
ä¹¡	xiÄng	7	3
ç¬‘	xiÃ o	11	3
ç›	yÃ¡n	6	3
çœ¼	yÇn	4	3
è¯	yÃ o	3	3
éªŒ	yÃ n	8	3
åŒ»	yÄ«	3	3
ç–‘	yÃ­	7	3
å·²	yÇ	11	3
æ„	yÃ¬	10	3
è‹±	yÄ«ng	8	3
é™¢	yuÃ n	3	3
å…ƒ	yuÃ¡n	9	3
é€ 	zÃ o	9	3
æ€	zÄ›n	11	3
é’ˆ	zhÄ“n	3	3
äº‰	zhÄ“ng	6	3
ä¹‹	zhÄ«	9	3
åª	zhÇ	4	3
çŸ¥	zhÄ«	5	3
è¿½	zhuÄ«	10	3
æ‰	zhuÅ	11	3
è‡ª	zÃ¬	6	3
å˜´	zuÇ	4	3
çº¸	zhÇ	9	3
ç 	zhÅ«	5	3
ç«¹	zhÃº	9	3
ä¸“	zhuÄn	11	3
å•Š	a	2	4
å®‰	Än	1	4
å²¸	Ã n	2	4
æ¬	bÄn	11	4
åŠ	bÃ n	5	4
å†°	bÄ«ng	11	4
ä¼¯	bÃ³	5	4
æ‰	cÃ¡i	4	4
é¤	cÄn	7	4
å¯Ÿ	chÃ¡	11	4
åœº	chÇng	1	4
åŸ	chÃ©ng	1	4
å¤„	chÃ¹	4	4
èˆ¹	chuÃ¡n	10	4
ä¸²	chuÃ n	10	4
çª—	chuÄng	3	4
æ¬¡	cÃ¬	12	4
èª	cÅng	8	4
è¾¾	dÃ¡	12	4
ç­”	dÃ¡	10	4
å½“	dÄng	7	4
å²›	dÇo	2	4
ç™»	dÄ“ng	2	4
æ»´	dÄ«	7	4
å®š	dÃ¬ng	5	4
æ‡‚	dÇ’ng	11	4
æ³•	fÇ	8	4
é	fÄ“i	1	4
åˆ†	fÄ“n	2	4
å°	fÄ“ng	1	4
æœ	fÃº	4	4
å¯Œ	fÃ¹	1	4
è¯¥	gÄi	5	4
åˆš	gÄng	6	4
ç¼¸	gÄng	8	4
å®«	gÅng	3	4
æŒ‚	guÃ 	6	4
è§‚	guÄn	11	4
å¹¿	guÇng	1	4
æ±—	hÃ n	7	4
èˆª	hÃ¡ng	12	4
å·	hÃ o	1	4
å–	hÄ“	5	4
åŒ–	huÃ 	11	4
æ…Œ	huÄng	8	4
æ—¢	jÃ¬	5	4
å°–	jiÄn	10	4
å¥	jiÃ n	4	4
j	jiÃ n	10	4
çš†	jiÄ“	7	4
æ¥	jiÄ“	6	4
ç•Œ	jiÃ¨	12	4
è¿›	jÃ¬n	1	4
åŠ²	jÃ¬n	8	4
äº¬	jÄ«ng	1	4
æƒŠ	jÄ«ng	8	4
æ™¯	jÇng	2	4
é•œ	jÃ¬ng	3	4
ä¹…	jiÇ”	9	4
æ•‘	jiÃ¹	8	4
åº·	kÄng	4	4
é 	kÃ o	9	4
é¢—	kÄ“	9	4
ç©º	kÅng	9	4
å“­	kÅ«	8	4
è‹¦	kÇ”	7	4
å—	kuÃ i	8	4
å•¦	lÄ	6	4
æ	lÄo	6	4
ç±»	lÃ¨i	12	4
ç¦»	lÃ­	9	4
åŠ›	lÃ¬	9	4
ä¸½	lÃ¬	2	4
ç²’	lÃ¬	7	4
è¿	liÃ¡n	9	4
æ—	lÃ­n	3	4
è½	luÃ²	7	4
æ¯›	mÃ¡o	10	4
ç¾	mÄ›i	2	4
æ¢¦	mÃ¨ng	12	4
è¿·	mÃ­	3	4
çœ 	miÃ¡n	7	4
å¦™	miÃ o	11	4
æ³¥	nÃ­	12	4
å†œ	nÃ³ng	7	4
åŠª	nÇ”	9	4
æš–	nuÇn	4	4
ç›˜	pÃ¡n	7	4
ç¢°	pÃ¨ng	6	4
ç¥¨	piÃ o	1	4
å¹³	pÃ­ng	â€”	4
è‹¹	pÃ­ng	10	4
è‘¡	pÃº	10	4
æµ…	qiÇn	5	4
æ¡¥	qiÃ¡o	2	4
æ¸…	qÄ«ng	9	4
æ™´	qÃ­ng	11	4
çƒ	qiÃº	12	4
å–	qÇ”	1	4
è¶£	qÃ¹	3	4
å…¨	quÃ¡n	1	4
ç¾¤	qÃºn	6	4
å¦‚	rÃº	3	4
ä¼	sÇn	11	4
è‰²	sÃ¨	2	4
æ™’	shÃ i	4	4
å‹º	shÃ¡o	9	4
ä¼¸	shÄ“n	6	4
æ·±	shÄ“n	5	4
ç‹®	shÄ«	2	4
å®	shÃ­	12	4
ä½¿	shÇ	8	4
ä¸–	shÃ¬	12	4
ç†Ÿ	shÃº	4	4
æ•°	shÃ¹	9	4
å­™	sÅ«n	1	4
æŠ¬	tÃ¡i	6	4
è„	tÃ¡o	10	4
æ	tÃ­	1	4
å•¼	tÃ­	7	4
å…	tÄ«ng	3	4
çª	tÃ¹	5	4
å¼¯	wÄn	10	4
å®Œ	wÃ¡n	2	4
æ™š	wÇn	6	4
ç‹	wÃ¡ng	3	4
é—»	wÃ©n	7	4
æ¡	wÃ²	10	4
æˆ	xÃ¬	8	4
ç»†	xÃ¬	11	4
å“	xiÃ 	8	4
é¦™	xiÄng	3	4
åƒ	xiÃ ng	5	4
æ™“	xiÇo	7	4
äº›	xiÄ“	3	4
è¾›	xÄ«n	7	4
ä¿¡	xÃ¬n	1	4
å¯»	xÃºn	4	4
è¨€	yÃ¡n	11	4
æ²¿	yÃ¡n	2	4
ä»°	yÇng	9	4
æ ·	yÃ ng	3	4
å¶	yÃ¨	11	4
å½±	yÇng	3	4
æ˜ 	yÃ¬ng	3	4
é‚®	yÃ³u	1	4
äº	yÃº	6	4
å®‡	yÇ”	12	4
å‘˜	yuÃ¡n	12	4
åŸ	yuÃ¡n	5	4
åœ†	yuÃ¡n	10	4
ç ¸	zÃ¡	8	4
ç…§	zhÃ o	4	4
æ­£	zhÃ¨ng	5	4
ç›´	zhÃ­	6	4
æŸ±	zhÃ¹	2	4
è‘—	zhÃ¹	9	4
è£…	zhuÄng	8	4
åº§	zuÃ²	2	4
`;

// ==========================================
// 2. å¯Œåª’ä½“æ•°æ®æ‰©å…… (Rich Data - å·²åˆå¹¶)
// ==========================================
const RICH_DATA_MAP = new Map([
  // === é‡ç‚¹ä¿®å¤ï¼šæ¢¦ ===
  ["æ¢¦", { 
    definition: "Dream", 
    structure: "ä¸Šä¸‹ç»“æ„", 
    radical: "æœ¨ (æˆ–å¤•)", 
    strokes: 11, 
    words: [
      "åšæ¢¦ (Dreaming)", 
      "æ¢¦æƒ³ (Dream/Ambition)", 
      "ç¾æ¢¦ (Sweet dream)",
      "æ¢¦è§ (To dream of)"
    ], 
    sentences: [
      "æˆ‘æ˜¨å¤©åšäº†ä¸€ä¸ªç¾æ¢¦ã€‚", 
      "æˆ‘çš„æ¢¦æƒ³æ˜¯å½“ä¸€åå®‡èˆªå‘˜ã€‚", 
      "å°çŒ«åœ¨æ¢¦é‡Œåƒåˆ°äº†å¤§é±¼ã€‚"
    ] 
  }],

  // === å¸¸ç”¨å­—ä¼˜åŒ– ===
  ["çˆ±", { definition: "Love", structure: "ä¸Šä¸‹", radical: "çˆª", strokes: 10, words: ["çˆ±å¥½ (Hobby)", "å¯çˆ± (Cute)", "çˆ±äºº (Lover)"], sentences: ["æˆ‘çˆ±æˆ‘çš„å®¶ã€‚", "ä½ å–œæ¬¢ä»€ä¹ˆçˆ±å¥½ï¼Ÿ", "è¿™ä¸ªå®å®å¾ˆå¯çˆ±ã€‚"] }],
  ["è°¢", { definition: "Thank", structure: "å·¦ä¸­å³", radical: "è® ", strokes: 12, words: ["è°¢è°¢ (Thanks)", "æ„Ÿè°¢ (Grateful)", "å¤šè°¢ (Many thanks)"], sentences: ["è°¢è°¢ä½ çš„å¸®åŠ©ã€‚", "æˆ‘ä»¬è¦å­¦ä¼šæ„Ÿè°¢çˆ¶æ¯ã€‚", "å¦‚æœä¸å°å¿ƒåšé”™äº†ï¼Œè¦è¯´å¯¹ä¸èµ·ã€‚"] }],
  ["æ¸¸", { definition: "Swim/Tour", structure: "å·¦å³", radical: "æ°µ", strokes: 12, words: ["æ¸¸æ³³ (Swim)", "æ¸¸æˆ (Game)", "æ—…æ¸¸ (Travel)"], sentences: ["æˆ‘ä»¬è¦å»æµ·è¾¹æ¸¸æ³³ã€‚", "è¿™ä¸ªç”µè„‘æ¸¸æˆå¾ˆå¥½ç©ã€‚", "æš‘å‡æˆ‘æƒ³å»åŒ—äº¬æ—…æ¸¸ã€‚"] }],
  ["é›ª", { definition: "Snow", structure: "ä¸Šä¸‹", radical: "é›¨", strokes: 11, words: ["ä¸‹é›ª (Snowing)", "é›ªèŠ± (Snowflake)", "é›ªäºº (Snowman)"], sentences: ["å¤–é¢ä¸‹é›ªäº†ï¼Œå¥½å†·å•Šã€‚", "æˆ‘ä»¬ä¸€èµ·å»å †é›ªäººå§ï¼", "é›ªèŠ±æ˜¯ç™½è‰²çš„ã€‚"] }],
  
  // === åŸºç¡€å­—åº“ ===
  ["å…«", { definition: "Eight", structure: "ç‹¬ä½“", radical: "å…«", strokes: 2, words: ["å…«æœˆ (August)", "å…«ä¸ª (Eight items)"], sentences: ["ç°åœ¨æ˜¯å…«ç‚¹ã€‚", "æˆ‘æœ‰å…«æœ¬ä¹¦ã€‚"] }],
  ["çˆ¸", { definition: "Dad", structure: "ä¸Šä¸‹", radical: "çˆ¶", strokes: 8, words: ["çˆ¸çˆ¸ (Dad)", "è€çˆ¸ (Dad - colloquial)"], sentences: ["æˆ‘çˆ¸çˆ¸æ˜¯åŒ»ç”Ÿã€‚", "çˆ¸çˆ¸å»ä¸Šç­äº†ã€‚"] }],
  ["ç™½", { definition: "White", structure: "ç‹¬ä½“", radical: "ç™½", strokes: 5, words: ["ç™½è‰² (White color)", "ç™½å¤© (Daytime)", "æ˜ç™½ (Understand)"], sentences: ["äº‘æ˜¯ç™½è‰²çš„ã€‚", "æˆ‘ä¸æ˜ç™½ä½ çš„æ„æ€ã€‚", "ç™½å¤©æˆ‘ä»¬å»å…¬å›­ã€‚"] }],
  ["ç™¾", { definition: "Hundred", structure: "ç‹¬ä½“", radical: "ç™½", strokes: 6, words: ["ä¸€ç™¾ (One hundred)", "ç™¾ä¸‡ (Million)"], sentences: ["è¿™æœ¬ä¹¦æœ‰ä¸€ç™¾é¡µã€‚", "è¿™é‡Œæœ‰å¾ˆå¤šäººã€‚"] }],
  ["å¤§", { definition: "Big", structure: "ç‹¬ä½“", radical: "å¤§", strokes: 3, words: ["å¤§äºº (Adult)", "å¤§å®¶ (Everyone)", "å¤§æ¥¼ (Building)"], sentences: ["è¿™ä¸ªè‹¹æœå¾ˆå¤§ã€‚", "å¤§å®¶å¥½ï¼", "æˆ‘è¦å»å¤§æ¥¼é‡Œä¹°ä¸œè¥¿ã€‚"] }],
  ["å­¦", { definition: "Study", structure: "ä¸Šä¸‹", radical: "å­", strokes: 8, words: ["å­¦æ ¡ (School)", "å­¦ç”Ÿ (Student)", "å­¦ä¹  (Study)"], sentences: ["æˆ‘ä»¬åœ¨å­¦æ ¡å­¦ä¹ ã€‚", "æˆ‘æ˜¯å°å­¦ç”Ÿã€‚", "å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚"] }],
  ["ä¹¦", { definition: "Book", structure: "ç‹¬ä½“", radical: "ä¸¨", strokes: 4, words: ["çœ‹ä¹¦ (Read)", "ä¹¦åŒ… (Schoolbag)", "ä¹¦åº— (Bookstore)"], sentences: ["æˆ‘å–œæ¬¢çœ‹ä¹¦ã€‚", "æˆ‘çš„ä¹¦åŒ…æ˜¯è“è‰²çš„ã€‚", "æˆ‘ä»¬å»ä¹¦åº—ä¹°ç¬”ã€‚"] }],
  ["å¤©", { definition: "Sky/Day", structure: "ç‹¬ä½“", radical: "å¤§", strokes: 4, words: ["ä»Šå¤© (Today)", "æ˜å¤© (Tomorrow)", "å¤©ç©º (Sky)"], sentences: ["ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚", "å¤©ç©ºæ˜¯è“è‰²çš„ã€‚", "æ˜å¤©æˆ‘ä»¬å»åŠ¨ç‰©å›­ã€‚"] }],
  ["ä¸­", { definition: "Middle/China", structure: "ç‹¬ä½“", radical: "ä¸¨", strokes: 4, words: ["ä¸­å›½ (China)", "ä¸­é—´ (Middle)", "ä¸­æ–‡ (Chinese)"], sentences: ["æˆ‘åœ¨å­¦ä¸­æ–‡ã€‚", "ä¸­å›½å¾ˆå¤§ã€‚", "ååœ¨ä¸­é—´çš„äººæ˜¯è°ï¼Ÿ"] }],
  ["å¥½", { definition: "Good", structure: "å·¦å³", radical: "å¥³", strokes: 6, words: ["ä½ å¥½ (Hello)", "å¥½äºº (Good person)", "å¥½åƒ (Delicious)"], sentences: ["ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚", "è¿™ä¸ªèœå¾ˆå¥½åƒã€‚", "ä»–æ˜¯ä¸€ä¸ªå¥½äººã€‚"] }],
  ["æ°´", { definition: "Water", structure: "ç‹¬ä½“", radical: "æ°´", strokes: 4, words: ["å–æ°´ (Drink water)", "æ°´æœ (Fruit)", "é›¨æ°´ (Rainwater)"], sentences: ["å¤šå–æ°´å¯¹èº«ä½“å¥½ã€‚", "æˆ‘æƒ³åƒæ°´æœã€‚", "åœ°ä¸Šæœ‰å¾ˆå¤šæ°´ã€‚"] }],
  ["ç«", { definition: "Fire", structure: "ç‹¬ä½“", radical: "ç«", strokes: 4, words: ["ç«è½¦ (Train)", "ç€ç« (On fire)", "ç«å±± (Volcano)"], sentences: ["ç«è½¦è·‘å¾—å¿«ã€‚", "ä¸è¦ç©ç«ã€‚", "é‚£æ˜¯ä¸€åº§ç«å±±ã€‚"] }],
  ["äºº", { definition: "Person", structure: "ç‹¬ä½“", radical: "äºº", strokes: 2, words: ["äººä»¬ (People)", "å¤§äºº (Adult)", "å¥½äºº (Good person)"], sentences: ["è¿™é‡Œæœ‰å¾ˆå¤šäººã€‚", "æˆ‘ä»¬è¦åšå¥½äººã€‚", "ä»–æ˜¯ç¾å›½äººã€‚"] }],
  ["å„¿", { definition: "Son/Child", structure: "ç‹¬ä½“", radical: "å„¿", strokes: 2, words: ["å„¿å­ (Son)", "å¥³å„¿ (Daughter)", "å„¿ç«¥ (Children)"], sentences: ["ä»–æ˜¯æˆ‘çš„å„¿å­ã€‚", "ä»Šå¤©æ˜¯å„¿ç«¥èŠ‚ã€‚", "èŠ±å„¿å¾ˆç¾ã€‚"] }],
  ["å£", { definition: "Mouth", structure: "ç‹¬ä½“", radical: "å£", strokes: 3, words: ["å£æ°´ (Saliva)", "è·¯å£ (Intersection)", "å¤§å£ (Big mouthful)"], sentences: ["ä¸è¦åœ¨è·¯å£ç©ã€‚", "è¯·å¤§å£åƒé¥­ã€‚", "å¼ å¼€å˜´å·´ã€‚"] }],
  ["ç›®", { definition: "Eye", structure: "ç‹¬ä½“", radical: "ç›®", strokes: 5, words: ["ç›®å…‰ (Gaze)", "ç›®çš„ (Purpose)", "ç›®å‰ (Currently)"], sentences: ["æˆ‘ä»¬è¦ä¿æŠ¤çœ¼ç›ã€‚", "ä½ çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ"] }],
  ["è€³", { definition: "Ear", structure: "ç‹¬ä½“", radical: "è€³", strokes: 6, words: ["è€³æœµ (Ear)", "è€³æœº (Headphones)"], sentences: ["å…”å­æœ‰é•¿é•¿çš„è€³æœµã€‚", "æˆ‘æˆ´ç€è€³æœºå¬éŸ³ä¹ã€‚"] }],
  ["æ‰‹", { definition: "Hand", structure: "ç‹¬ä½“", radical: "æ‰‹", strokes: 4, words: ["æ‰‹æœº (Mobile phone)", "åŒæ‰‹ (Both hands)", "æ¡æ‰‹ (Shake hands)"], sentences: ["è¯·æ´—æ‰‹ã€‚", "è¿™æ˜¯æˆ‘çš„æ‰‹æœºã€‚", "æˆ‘ä»¬è¦æ‰‹æ‹‰æ‰‹ã€‚"] }],
  ["è¶³", { definition: "Foot", structure: "ä¸Šä¸‹", radical: "è¶³", strokes: 7, words: ["è¶³çƒ (Football)", "æ‰‹è¶³ (Brothers/Hands and feet)"], sentences: ["æˆ‘å–œæ¬¢è¸¢è¶³çƒã€‚", "ç”»è›‡æ·»è¶³ã€‚"] }],
  ["æ—¥", { definition: "Sun/Day", structure: "ç‹¬ä½“", radical: "æ—¥", strokes: 4, words: ["æ—¥è®° (Diary)", "èŠ‚æ—¥ (Festival)", "ç”Ÿæ—¥ (Birthday)"], sentences: ["ç¥ä½ ç”Ÿæ—¥å¿«ä¹ã€‚", "ä»Šå¤©æ˜¯èŠ‚æ—¥ã€‚", "å¤ªé˜³å‡ºæ¥äº†ã€‚"] }],
  ["æœˆ", { definition: "Moon/Month", structure: "ç‹¬ä½“", radical: "æœˆ", strokes: 4, words: ["æœˆäº® (Moon)", "ä¸€æœˆ (January)", "æœˆé¥¼ (Mooncake)"], sentences: ["æœˆäº®å¼¯å¼¯çš„ã€‚", "ä¸­ç§‹èŠ‚åƒæœˆé¥¼ã€‚", "ä¸‹ä¸ªæœˆæ˜¯æˆ‘çš„ç”Ÿæ—¥ã€‚"] }],
  ["å±±", { definition: "Mountain", structure: "ç‹¬ä½“", radical: "å±±", strokes: 3, words: ["çˆ¬å±± (Hiking)", "å±±æ°´ (Landscape)", "é«˜å±± (High mountain)"], sentences: ["æˆ‘ä»¬å»çˆ¬å±±å§ã€‚", "å±±ä¸Šæœ‰æ ‘ã€‚", "è¿™å¹…å±±æ°´ç”»å¾ˆç¾ã€‚"] }],
  ["çŸ³", { definition: "Stone", structure: "åŠåŒ…å›´", radical: "çŸ³", strokes: 5, words: ["çŸ³å¤´ (Stone)", "å®çŸ³ (Gem)", "åŒ–çŸ³ (Fossil)"], sentences: ["æ²³è¾¹æœ‰å¾ˆå¤šçŸ³å¤´ã€‚", "è¿™æ˜¯ä¸€å—å®çŸ³ã€‚", "å°å¿ƒè¢«çŸ³å¤´ç»Šå€’ã€‚"] }],
  ["ç”°", { definition: "Field", structure: "ç‹¬ä½“", radical: "ç”°", strokes: 5, words: ["ç”°åœ° (Field)", "ç§ç”° (Farming)", "ç¨»ç”° (Rice paddy)"], sentences: ["å†œæ°‘åœ¨ç”°é‡Œå·¥ä½œã€‚", "è¿™ç‰‡ç”°åœ°å¾ˆå¤§ã€‚", "é’è›™åœ¨ç”°é‡Œå«ã€‚"] }],
  ["ç¦¾", { definition: "Grain", structure: "ç‹¬ä½“", radical: "ç¦¾", strokes: 5, words: ["ç¦¾è‹— (Seedling)"], sentences: ["ç¦¾è‹—é•¿é«˜äº†ã€‚", "æˆ‘ä»¬è¦çˆ±æƒœç²®é£Ÿã€‚"] }],
  ["å¯¹", { definition: "Correct/Right", structure: "å·¦å³", radical: "å¯¸", strokes: 5, words: ["ä¸å¯¹ (Wrong)", "å¯¹é¢ (Opposite)", "å¯¹è¯ (Dialogue)"], sentences: ["ä½ åšå¯¹äº†ã€‚", "å­¦æ ¡åœ¨å…¬å›­å¯¹é¢ã€‚", "è¯·ç»ƒä¹ å¯¹è¯ã€‚"] }],
  ["äº‘", { definition: "Cloud", structure: "ç‹¬ä½“", radical: "äºŒ", strokes: 4, words: ["ç™½äº‘ (White cloud)", "ä¹Œäº‘ (Dark cloud)", "å¤šäº‘ (Cloudy)"], sentences: ["å¤©ä¸Šæœ‰ç™½äº‘ã€‚", "ä»Šå¤©è¦ä¸‹é›¨ï¼Œå…¨æ˜¯ä¹Œäº‘ã€‚", "æ˜å¤©å¤šäº‘ã€‚"] }],
  ["é›¨", { definition: "Rain", structure: "ç‹¬ä½“", radical: "é›¨", strokes: 8, words: ["ä¸‹é›¨ (Raining)", "é›¨è¡£ (Raincoat)", "é›¨ä¼ (Umbrella)"], sentences: ["å¤–é¢åœ¨ä¸‹é›¨ã€‚", "å‡ºé—¨è®°å¾—å¸¦é›¨ä¼ã€‚", "æˆ‘å–œæ¬¢åœ¨é›¨ä¸­èµ°ã€‚"] }],
  ["é£", { definition: "Wind", structure: "åŠåŒ…å›´", radical: "é£", strokes: 4, words: ["å¤§é£ (Strong wind)", "é£ç­ (Kite)", "å¹é£ (Blow)"], sentences: ["ä»Šå¤©é£å¾ˆå¤§ã€‚", "æˆ‘ä»¬åœ¨å…¬å›­æ”¾é£ç­ã€‚", "é£å¹åœ¨è„¸ä¸Šå¾ˆèˆ’æœã€‚"] }],
  ["èŠ±", { definition: "Flower", structure: "ä¸Šä¸‹", radical: "è‰¹", strokes: 7, words: ["èŠ±æœµ (Flower)", "èŠ±å›­ (Garden)", "å¼€èŠ± (Bloom)"], sentences: ["æ˜¥å¤©èŠ±å¼€äº†ã€‚", "èŠ±å›­é‡Œå¾ˆæ¼‚äº®ã€‚", "è¿™æœµèŠ±æ˜¯çº¢è‰²çš„ã€‚"] }],
  ["é¸Ÿ", { definition: "Bird", structure: "ç‹¬ä½“", radical: "é¸Ÿ", strokes: 5, words: ["å°é¸Ÿ (Bird)", "é¸Ÿå„¿ (Birds)", "é£é¸Ÿ (Flying bird)"], sentences: ["å°é¸Ÿåœ¨å”±æ­Œã€‚", "é¸Ÿå„¿åœ¨å¤©ä¸Šé£ã€‚", "æ ‘ä¸Šæœ‰ä¸€åªé¸Ÿã€‚"] }],
  ["è™«", { definition: "Insect", structure: "ç‹¬ä½“", radical: "è™«", strokes: 6, words: ["è™«å­ (Worm/Insect)", "æ˜†è™« (Insect)", "æ¯›æ¯›è™« (Caterpillar)"], sentences: ["é¸Ÿå„¿åƒè™«å­ã€‚", "è¿™æ˜¯ä¸€åªæ˜†è™«ã€‚", "æ¯›æ¯›è™«å˜æˆäº†è´è¶ã€‚"] }],
  ["å…­", { definition: "Six", structure: "ä¸Šä¸‹", radical: "å…«", strokes: 4, words: ["å…­ä¸ª (Six)", "å…­æœˆ (June)"], sentences: ["æˆ‘æœ‰å…­æ”¯ç¬”ã€‚", "å…­æœˆæ˜¯å¾ˆçƒ­çš„ã€‚"] }],
  ["ä¸ƒ", { definition: "Seven", structure: "ç‹¬ä½“", radical: "ä¸€", strokes: 2, words: ["ä¸ƒä¸ª (Seven)", "ä¸ƒæœˆ (July)"], sentences: ["ä¸€å‘¨æœ‰ä¸ƒå¤©ã€‚", "ä¸ƒä¸ªå°çŸ®äººã€‚"] }],
  ["ä¹", { definition: "Nine", structure: "ç‹¬ä½“", radical: "ä¸¿", strokes: 2, words: ["ä¹ä¸ª (Nine)", "ä¹æœˆ (September)"], sentences: ["æˆ‘æœ‰ä¹ä¸ªè‹¹æœã€‚", "ä¹æœˆå¼€å­¦äº†ã€‚"] }],
  ["å", { definition: "Ten", structure: "ç‹¬ä½“", radical: "å", strokes: 2, words: ["åä¸ª (Ten)", "åæœˆ (October)"], sentences: ["æ•°åˆ°åã€‚", "åå…¨åç¾ã€‚"] }],
  ["æ–¹", { definition: "Square/Direction", structure: "ç‹¬ä½“", radical: "æ–¹", strokes: 4, words: ["æ–¹å‘ (Direction)", "æ­£æ–¹å½¢ (Square)", "åœ°æ–¹ (Place)"], sentences: ["è¿™æ˜¯ä»€ä¹ˆåœ°æ–¹ï¼Ÿ", "æ­£æ–¹å½¢æœ‰å››æ¡è¾¹ã€‚", "è¯·çœ‹é‚£ä¸ªæ–¹å‘ã€‚"] }],
  ["å›½", { definition: "Country", structure: "å…¨åŒ…å›´", radical: "å›—", strokes: 8, words: ["å›½å®¶ (Country)", "å›½ç‹ (King)", "ä¸­å›½ (China)"], sentences: ["æˆ‘çˆ±æˆ‘çš„å›½å®¶ã€‚", "å›½ç‹ä½åœ¨åŸå ¡é‡Œã€‚", "ä½ æ˜¯å“ªå›½äººï¼Ÿ"] }],
]);

// ==========================================
// è¯­éŸ³åˆæˆå·¥å…·å‡½æ•°
// ==========================================
const speak = (text) => {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'zh-CN';
    utterance.rate = 0.85; 
    window.speechSynthesis.speak(utterance);
  }
};

// ==========================================
// API è®¾ç½®ç»„ä»¶ (MXNZP - ä¸‡ç»´æ˜“æº/é˜¿ç«¥ç©†)
// ==========================================
const ApiKeyModal = ({ isOpen, onClose, onSave }) => {
  const [appId, setAppId] = useState('');
  const [appSecret, setAppSecret] = useState('');

  useEffect(() => {
    const savedAppId = localStorage.getItem('mxnzp_app_id');
    const savedAppSecret = localStorage.getItem('mxnzp_app_secret');
    
    if (savedAppId) setAppId(savedAppId);
    else setAppId('yht8jotxk8qllhot'); 

    if (savedAppSecret) setAppSecret(savedAppSecret);
    else setAppSecret('A0WaDQ9lfGnPTA9eqHFE45ZR9LY3B4uQ'); 

  }, [isOpen]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl w-full max-w-md shadow-2xl p-6 transform transition-all relative">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
            <Settings size={20} className="text-teal-600"/>
            MXNZP API è®¾ç½®
          </h3>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X size={24} />
          </button>
        </div>
        
        <div className="space-y-4">
          <p className="text-sm text-gray-500">
            è¯·é…ç½® <span className="font-mono bg-gray-100 px-1 rounded">MXNZP (é˜¿ç«¥ç©†)</span> æ¥å£ä¿¡æ¯ã€‚
          </p>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">App ID</label>
            <input 
              type="text" 
              className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none font-mono text-sm"
              placeholder="è¯·è¾“å…¥ App ID"
              value={appId}
              onChange={(e) => setAppId(e.target.value)}
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">App Secret</label>
            <input 
              type="text" 
              className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none font-mono text-sm"
              placeholder="è¯·è¾“å…¥ App Secret"
              value={appSecret}
              onChange={(e) => setAppSecret(e.target.value)}
            />
          </div>
          
          <button 
            onClick={() => {
              localStorage.setItem('mxnzp_app_id', appId);
              localStorage.setItem('mxnzp_app_secret', appSecret);
              onSave({ appId, appSecret });
              onClose();
            }}
            className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg transition"
          >
            ä¿å­˜è®¾ç½®
          </button>
        </div>
      </div>
    </div>
  );
};

// ==========================================
// æ ¸å¿ƒç»„ä»¶ï¼šHanziWriter å°è£… (æ™ºèƒ½æçº¢)
// ==========================================
const HanziWriterBoard = ({ char, onLoaded }) => {
  const writerRef = useRef(null);
  const divRef = useRef(null);
  const [isAnimating, setIsAnimating] = useState(false);
  const [mode, setMode] = useState('display'); 

  useEffect(() => {
    // ä½¿ç”¨ CDN æ–¹å¼åŠ è½½ hanzi-writerï¼Œé¿å…æœ¬åœ° npm ä¾èµ–é—®é¢˜ï¼Œä¹Ÿæ–¹ä¾¿åœ¨çº¿é¢„è§ˆ
    if (!window.HanziWriter) {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js';
      script.async = true;
      script.onload = () => initWriter();
      document.body.appendChild(script);
    } else {
      initWriter();
    }
  }, [char]);

  const initWriter = () => {
    if (!divRef.current || !window.HanziWriter) return;
    divRef.current.innerHTML = "";
    try {
      writerRef.current = window.HanziWriter.create(divRef.current, char, {
        width: 300,
        height: 300,
        padding: 20,
        showOutline: true,
        strokeAnimationSpeed: 1, 
        delayBetweenStrokes: 200, 
        strokeColor: '#0d9488', 
        radicalColor: '#f59e0b', 
        outlineColor: '#e2e8f0', 
        drawingWidth: 20, 
        showCharacter: true,
        showHintAfterMisses: 1, 
        highlightOnComplete: true,
      });
      if(onLoaded) onLoaded();
    } catch(e) {
      console.error("HanziWriter init error", e);
      divRef.current.innerHTML = "<div class='text-red-400 p-4 text-center'>âš ï¸ è¯¥å­—æš‚æ— ç¬”é¡ºåŠ¨ç”»<br/><span class='text-xs text-gray-400'>è¯·å°è¯•å…¶ä»–å¸¸ç”¨å­—</span></div>";
    }
  };

  const animate = () => {
    if (writerRef.current) {
      setIsAnimating(true);
      setMode('display');
      writerRef.current.animateCharacter({
        onComplete: () => setIsAnimating(false)
      });
    }
  };

  const startQuiz = () => {
    if (writerRef.current) {
      setMode('quiz');
      writerRef.current.quiz({
        onComplete: (res) => {
            alert(`å¤ªæ£’äº†ï¼ä½ å†™äº† ${res.totalMistakes} ä¸ªé”™è¯¯ã€‚ (Great job!)`);
            speak("å¤ªæ£’äº†");
        }
      });
    }
  };

  return (
    <div className="flex flex-col items-center gap-4">
      <div 
        className="relative bg-[#fff9e6] border-4 border-amber-600 rounded-2xl shadow-lg overflow-hidden select-none"
        style={{ width: '300px', height: '300px' }}
      >
        <div className="absolute inset-0 pointer-events-none z-0">
          <div className="w-full h-1/2 border-b border-dashed border-red-300 opacity-50"></div>
          <div className="absolute top-0 left-1/2 w-0 h-full border-r border-dashed border-red-300 opacity-50 transform -translate-x-1/2"></div>
          <div className="absolute top-0 left-0 w-full h-full border border-red-300 opacity-30 m-0"></div>
        </div>
        
        <div ref={divRef} className="absolute inset-0 z-10 cursor-crosshair" />
        
        <div className="absolute top-2 right-2 px-2 py-1 bg-white/80 rounded text-xs font-bold text-gray-500 shadow-sm backdrop-blur-sm">
            {mode === 'display' ? 'ğŸ‘€ è§‚çœ‹' : 'âœï¸ ç»ƒä¹ '}
        </div>
      </div>

      <div className="flex gap-3">
        <button 
          onClick={animate}
          disabled={isAnimating}
          className={`flex items-center gap-2 px-5 py-2.5 rounded-full font-bold shadow-md transition transform active:scale-95 ${
            isAnimating ? 'bg-gray-100 text-gray-400' : 'bg-teal-500 hover:bg-teal-600 text-white'
          }`}
        >
          <Play size={18} fill={isAnimating ? "gray" : "white"} />
          {isAnimating ? 'æ’­æ”¾ä¸­...' : 'çœ‹ç¬”é¡º'}
        </button>

        <button 
          onClick={startQuiz}
          className={`flex items-center gap-2 px-5 py-2.5 rounded-full font-bold shadow-md transition transform active:scale-95 ${
            mode === 'quiz' ? 'bg-amber-500 text-white ring-2 ring-amber-200' : 'bg-white text-amber-600 border border-amber-200 hover:bg-amber-50'
          }`}
        >
          <Edit3 size={18} />
          ç»ƒä¸€ç»ƒ
        </button>
      </div>
      
      <p className="text-xs text-gray-400 mt-2">
         {mode === 'quiz' ? 'è¯·åœ¨ç”°å­—æ ¼ä¸­æŒ‰ç¬”é¡ºå†™å­—' : 'ç‚¹å‡»â€œçœ‹ç¬”é¡ºâ€è§‚çœ‹åŠ¨ç”»ï¼Œæˆ–ç‚¹å‡»â€œç»ƒä¸€ç»ƒâ€å¼€å§‹ä¹¦å†™'}
      </p>
    </div>
  );
};

// ==========================================
// å¯æŠ˜å é‡Šä¹‰ç»„ä»¶
// ==========================================
const ExpandableDefinition = ({ text }) => {
  const [expanded, setExpanded] = useState(false);
  // Reset expansion when text changes (new character selected)
  useEffect(() => { setExpanded(false); }, [text]);

  const isLong = text && text.length > 60;

  return (
    <div className="relative">
      <p className={`text-lg text-gray-500 font-medium transition-all duration-300 ${expanded ? '' : 'line-clamp-3'}`}>
        {text}
      </p>
      {isLong && (
        <button 
          onClick={() => setExpanded(!expanded)}
          className="text-teal-600 text-sm font-bold mt-1 hover:text-teal-700 flex items-center gap-1 bg-white/80 backdrop-blur-sm px-2 py-0.5 rounded"
        >
          {expanded ? "æ”¶èµ· (Collapse)" : "å±•å¼€æ›´å¤š (Expand)"}
          <ChevronDown size={14} className={`transform transition-transform ${expanded ? '-rotate-180' : 'rotate-0'}`} />
        </button>
      )}
    </div>
  );
};

// ==========================================
// æ·»åŠ ç”Ÿå­—è¡¨å•ç»„ä»¶ (Add Form)
// ==========================================
const AddCharacterForm = ({ onAdd }) => {
  const [formData, setFormData] = useState({
    char: '', pinyin: '', definition: '', lesson: '', volume: '', words: '', sentences: '',
    structure: '', radical: '' 
  });

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!formData.char) return;

    const newChar = {
      ...formData,
      id: `custom-${Date.now()}`,
      // å°†æ¢è¡Œåˆ†éš”çš„æ–‡æœ¬è½¬æ¢ä¸ºæ•°ç»„
      words: formData.words.split('\n').filter(w => w.trim()),
      sentences: formData.sentences.split('\n').filter(s => s.trim()),
      structure: formData.structure || 'ç”¨æˆ·æ·»åŠ ',
      radical: formData.radical || '-',
      strokes: '-', // ç¬”ç”»æ•°æš‚æ—¶ä¿æŒé»˜è®¤ï¼Œå› ä¸ºé€šå¸¸éœ€è¦æŸ¥åº“
      isRich: true, // ç”¨æˆ·è‡ªå·±æ·»åŠ çš„ä¹Ÿç®—Rich data
      isCustom: true // æ ‡è®°ä¸ºè‡ªå®šä¹‰æ•°æ®
    };

    onAdd(newChar);
    setFormData({ char: '', pinyin: '', definition: '', lesson: '', volume: '', words: '', sentences: '', structure: '', radical: '' });
    alert("ä¿å­˜æˆåŠŸï¼ç”Ÿå­—å·²æ·»åŠ åˆ°æœ¬åœ°å­˜å‚¨ã€‚\n(Saved to Local Storage!)");
  };

  return (
    <div className="bg-white rounded-3xl shadow-md border border-teal-100 overflow-hidden mt-8 mb-10">
      <div className="bg-teal-600 px-6 py-4 flex items-center gap-2 text-white">
        <PlusCircle size={22} />
        <h2 className="text-lg font-bold">æ·»åŠ /è¡¥å……ç”Ÿå­— (Add Character)</h2>
      </div>
      <form onSubmit={handleSubmit} className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">æ±‰å­— (Char)</label>
              <input 
                required
                maxLength={1}
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.char}
                onChange={e => setFormData({...formData, char: e.target.value})}
                placeholder="ä¾‹: çˆ±"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">æ‹¼éŸ³ (Pinyin)</label>
              <input 
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.pinyin}
                onChange={e => setFormData({...formData, pinyin: e.target.value})}
                placeholder="ä¾‹: Ã i"
              />
            </div>
          </div>

          {/* æ–°å¢ï¼šéƒ¨é¦–å’Œç»“æ„è¾“å…¥æ¡† */}
          <div className="grid grid-cols-2 gap-4">
             <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">éƒ¨é¦– (Radical)</label>
              <input 
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.radical}
                onChange={e => setFormData({...formData, radical: e.target.value})}
                placeholder="ä¾‹: æ°µ"
              />
            </div>
             <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ç»“æ„ (Structure)</label>
              <input 
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.structure}
                onChange={e => setFormData({...formData, structure: e.target.value})}
                placeholder="ä¾‹: å·¦å³ç»“æ„"
              />
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
             <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">å†Œ (Volume)</label>
              <input 
                type="number"
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.volume}
                onChange={e => setFormData({...formData, volume: e.target.value})}
                placeholder="1"
              />
            </div>
             <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">è¯¾æ¬¡ (Lesson)</label>
              <input 
                className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
                value={formData.lesson}
                onChange={e => setFormData({...formData, lesson: e.target.value})}
                placeholder="7"
              />
            </div>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">é‡Šä¹‰ (Definition)</label>
            <input 
              className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50" 
              value={formData.definition}
              onChange={e => setFormData({...formData, definition: e.target.value})}
              placeholder="English definition"
            />
          </div>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">æ‰©å±•è¯è¯­ (Words - æ¯è¡Œä¸€ä¸ª)</label>
            <textarea 
              className="w-full p-2 border rounded-lg h-24 focus:ring-2 focus:ring-teal-500 outline-none font-mono text-sm bg-slate-50" 
              value={formData.words}
              onChange={e => setFormData({...formData, words: e.target.value})}
              placeholder="çˆ±å¥½ (hobby)&#10;å¯çˆ± (cute)"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">æ‰©å±•ä¾‹å¥ (Sentences - æ¯è¡Œä¸€ä¸ª)</label>
            <textarea 
              className="w-full p-2 border rounded-lg h-24 focus:ring-2 focus:ring-teal-500 outline-none font-mono text-sm bg-slate-50" 
              value={formData.sentences}
              onChange={e => setFormData({...formData, sentences: e.target.value})}
              placeholder="æˆ‘çˆ±æˆ‘çš„å®¶ã€‚&#10;è¿™åªçŒ«å¾ˆå¯çˆ±ã€‚"
            />
          </div>
          <button type="submit" className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition shadow-md">
            <Save size={20} />
            ä¿å­˜åˆ°åˆ—è¡¨ (Save & Cache)
          </button>
        </div>
      </form>
    </div>
  );
};

// ==========================================
// ä¸»åº”ç”¨ç»„ä»¶
// ==========================================
export default function HanziLearningApp() {
  const [database, setDatabase] = useState([]);
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedChar, setSelectedChar] = useState(null);
  const [showList, setShowList] = useState(false);
  const [isSettingsOpen, setIsSettingsOpen] = useState(false);
  const [apiConfig, setApiConfig] = useState({ appId: '', appSecret: '' });
  const [isSearchingApi, setIsSearchingApi] = useState(false);

  // åˆå§‹åŒ–æ•°æ®ï¼šåˆå¹¶ åŸå§‹æ•°æ® + å¯Œåª’ä½“æ•°æ® + æœ¬åœ°å­˜å‚¨æ•°æ®
  useEffect(() => {
    // åŠ è½½ API Credentials
    const savedAppId = localStorage.getItem('mxnzp_app_id');
    const savedAppSecret = localStorage.getItem('mxnzp_app_secret');
    
    // ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„å€¼ï¼Œæˆ–è€…é»˜è®¤å€¼ï¼ˆä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œé¢„è®¾äº†æ‚¨æä¾›çš„ Keyï¼‰
    const finalAppId = savedAppId || 'yht8jotxk8qllhot';
    const finalAppSecret = savedAppSecret || 'A0WaDQ9lfGnPTA9eqHFE45ZR9LY3B4uQ';
    
    setApiConfig({ appId: finalAppId, appSecret: finalAppSecret });
    
    // å¦‚æœæœ¬åœ°æ²¡æœ‰å­˜ï¼Œé¡ºä¾¿å­˜ä¸€ä¸‹é»˜è®¤å€¼ä»¥ä¾¿ä¸‹æ¬¡ UI æ­£å¸¸æ˜¾ç¤º
    if(!savedAppId) localStorage.setItem('mxnzp_app_id', finalAppId);
    if(!savedAppSecret) localStorage.setItem('mxnzp_app_secret', finalAppSecret);


    // 1. è§£æåŸå§‹å¤§æ–‡æœ¬
    const lines = RAW_DATA_SOURCE.trim().split('\n');
    const parsedData = lines.map((line, index) => {
      const parts = line.split(/[\t\s]+/).filter(p => p);
      if (parts.length < 2) return null;
      
      const char = parts[0];
      const pinyin = parts[1];
      const lesson = parts[2] || "-";
      const volume = parts[3] || "-";

      const richData = RICH_DATA_MAP.get(char);

      // æ™ºèƒ½ç”Ÿæˆ Fallback (ä»…å½“æ²¡æœ‰å¯Œæ•°æ®æ—¶)
      const fallbackWords = [];
      const fallbackSentences = [];
      
      fallbackSentences.push(`è¯·å¤§å£°æœ—è¯»ï¼š${char} (${pinyin})ã€‚`);
      
      if(!richData) {
          fallbackWords.push(`æš‚æ— è¯ç»„ (No words yet)`);
          fallbackSentences.push(`è¯·ç‚¹å‡»ä¸‹æ–¹æ·»åŠ æŒ‰é’®è¡¥å……ä¾‹å¥ã€‚`);
      }

      return {
        id: `static-${char}`,
        char,
        pinyin,
        lesson,
        volume,
        definition: richData?.definition || "Chinese Character",
        structure: richData?.structure || "æ±‰å­—",
        radical: richData?.radical || "-",
        strokes: richData?.strokes || "-",
        words: richData?.words || fallbackWords,
        sentences: richData?.sentences || fallbackSentences,
        isRich: !!richData,
        isCustom: false
      };
    }).filter(item => item !== null);

    // 2. åŠ è½½æœ¬åœ°å­˜å‚¨çš„è‡ªå®šä¹‰æ•°æ®
    let localData = [];
    try {
        const savedData = localStorage.getItem('hanzi_app_custom_data');
        if (savedData) {
            localData = JSON.parse(savedData);
        }
    } catch (error) {
        console.error("Failed to load local storage", error);
    }

    // 3. åˆå¹¶é€»è¾‘ï¼šæœ¬åœ°æ•°æ®ä¼˜å…ˆè¦†ç›–é™æ€æ•°æ®
    const dataMap = new Map();
    
    // å…ˆæ”¾é™æ€æ•°æ®
    parsedData.forEach(item => dataMap.set(item.char, item));
    // å†æ”¾æœ¬åœ°æ•°æ®ï¼ˆè¦†ç›–ï¼‰
    localData.forEach(item => dataMap.set(item.char, item));

    const finalData = Array.from(dataMap.values());
    setDatabase(finalData);
    
    // é»˜è®¤æŸ¥æ‰¾ "æ¢¦"ï¼Œå¦‚æœæ²¡æœ‰åˆ™é€‰ç¬¬ä¸€ä¸ª
    const dreamChar = finalData.find(c => c.char === 'æ¢¦');
    if (dreamChar) {
        setSelectedChar(dreamChar);
    } else if (finalData.length > 0) {
        setSelectedChar(finalData[0]);
    }
  }, []);

  // æœç´¢è¿‡æ»¤
  const filteredData = useMemo(() => {
    if (!searchTerm) return [];
    const lowerTerm = searchTerm.toLowerCase();
    return database.filter(item => 
      item.char.includes(lowerTerm) || 
      item.pinyin.toLowerCase().includes(lowerTerm)
    );
  }, [searchTerm, database]);

  // è°ƒç”¨ MXNZP API
  const fetchCharacterFromApi = async (char) => {
    if (!apiConfig.appId || !apiConfig.appSecret) {
      alert("è¯·å…ˆç‚¹å‡»å³ä¸Šè§’è®¾ç½®å›¾æ ‡ï¼Œæ£€æŸ¥ MXNZP App ID å’Œ Secretã€‚");
      setIsSettingsOpen(true);
      return;
    }

    setIsSearchingApi(true);
    try {
      // MXNZP æ¥å£
      const url = `https://www.mxnzp.com/api/convert/dictionary?content=${encodeURIComponent(char)}&app_id=${apiConfig.appId}&app_secret=${apiConfig.appSecret}`;
      
      const response = await fetch(url);
      const data = await response.json();

      // MXNZP è¿”å›ç»“æ„æ£€æŸ¥
      if (data.code === 1 && data.data && data.data.length > 0) {
        // è·å–ç¬¬ä¸€ä¸ªç»“æœ
        // æ³¨æ„ï¼šMXNZP è¿”å›çš„ data å¯èƒ½æ˜¯æ•°ç»„ï¼ŒåŒ…å«æ¯ä¸ªå­—çš„è¯¦æƒ…
        const res = data.data[0]; 
        
        // æ•°æ®æ˜ å°„
        let definition = res.explanation || "ç½‘ç»œæŸ¥è¯¢ç»“æœ";
        
        // å°è¯•æå–ç»“æ„åŒ–æ•°æ®
        const newChar = {
          id: `api-mxnzp-${char}-${Date.now()}`,
          char: char, // æ¥å£æœ‰æ—¶ä¸ç›´æ¥è¿”å›åŸå­—ï¼Œç”¨æœç´¢è¯
          pinyin: res.pinyin || "æœªçŸ¥",
          lesson: 'Cloud',
          volume: 'API',
          definition: definition, // ä¿å­˜å®Œæ•´é‡Šä¹‰ï¼Œä¸æˆªæ–­
          structure: "APIæ•°æ®", // MXNZP ä¸ä¸€å®šè¿”å›ç»“æ„
          radical: res.radicals || "-", // ä½¿ç”¨ radicals å­—æ®µä½œä¸ºéƒ¨é¦–
          strokes: res.strokes || "-",
          words: ["æš‚æ— æ‰©å±•è¯ (API)"], // ç®€å•å¤„ç†
          sentences: [definition], // æŠŠè§£é‡Šä½œä¸ºä¾‹å¥å±•ç¤º
          isRich: true,
          isCustom: true 
        };

        handleAddCharacter(newChar); 
        alert("æŸ¥è¯¢æˆåŠŸï¼å·²æ·»åŠ åˆ°æœ¬åœ°å­—åº“ã€‚");
      } else {
        alert(`æŸ¥è¯¢å¤±è´¥: ${data.msg || 'æœªæ‰¾åˆ°è¯¥å­—æˆ–æ¥å£å¼‚å¸¸'}`);
      }

    } catch (error) {
      console.error("API Error", error);
      alert("ç½‘ç»œè¯·æ±‚å¤±è´¥ã€‚\nè¯·æ£€æŸ¥ç½‘ç»œæˆ– App Secret æ˜¯å¦æ­£ç¡®ã€‚");
    } finally {
      setIsSearchingApi(false);
    }
  };

  // å¤„ç†æ·»åŠ æ–°å­— (ä¿å­˜åˆ° State å’Œ LocalStorage)
  const handleAddCharacter = (newChar) => {
    // 1. æ›´æ–° State
    const newDb = [...database];
    const existingIndex = newDb.findIndex(c => c.char === newChar.char);
    
    if (existingIndex >= 0) {
        newDb[existingIndex] = { ...newDb[existingIndex], ...newChar };
    } else {
        newDb.unshift(newChar);
    }
    setDatabase(newDb);
    setSelectedChar(newDb[existingIndex >= 0 ? existingIndex : 0]);
    
    // 2. ä¿å­˜åˆ° LocalStorage
    try {
        const currentCustoms = newDb.filter(i => i.isCustom);
        localStorage.setItem('hanzi_app_custom_data', JSON.stringify(currentCustoms));
    } catch (e) {
        console.error("Save failed", e);
    }
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  // åˆ é™¤è‡ªå®šä¹‰ç”Ÿå­—
  const handleDeleteCustom = (charId) => {
      if(!window.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè‡ªå®šä¹‰ç”Ÿå­—å—ï¼Ÿ")) return;
      
      const newDb = database.filter(item => item.id !== charId);
      setDatabase(newDb);
      
      // æ›´æ–° LocalStorage
      const currentCustoms = newDb.filter(i => i.isCustom);
      localStorage.setItem('hanzi_app_custom_data', JSON.stringify(currentCustoms));
      
      if(selectedChar.id === charId) setSelectedChar(newDb[0]);
  }

  const handleSelectChar = (char) => {
    setSelectedChar(char);
    setSearchTerm("");
    setShowList(false);
  };

  if (!selectedChar) return <div className="p-10 text-center text-teal-600">æ­£åœ¨åˆå§‹åŒ–å­—åº“...</div>;

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-20">
      
      {/* Settings Modal */}
      <ApiKeyModal 
        isOpen={isSettingsOpen} 
        onClose={() => setIsSettingsOpen(false)}
        onSave={setApiConfig}
      />

      <header className="bg-gradient-to-r from-teal-600 to-teal-800 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div className="max-w-5xl mx-auto flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                <BookOpen size={24} className="text-white" />
            </div>
            <div>
                <h1 className="text-xl font-bold tracking-wide">æ±‰å­—å­¦ä¹ å® Refined</h1>
                <p className="text-xs text-teal-100 opacity-80">å†…å®¹ç²¾ä¿®ç‰ˆ</p>
            </div>
          </div>
          <div className="flex items-center gap-3">
             <div className="text-xs bg-black/20 px-3 py-1 rounded-full text-teal-50 font-mono border border-white/10 hidden sm:block">
                æ€»å­—æ•°: {database.length}
             </div>
             <button 
                onClick={() => setIsSettingsOpen(true)}
                className="p-2 bg-white/10 hover:bg-white/20 rounded-full transition"
                title="è®¾ç½® API Key"
             >
                <Settings size={20} />
             </button>
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto p-4 space-y-8">
        
        {/* æœç´¢æ¡† */}
        <div className="relative">
          <div className="relative group">
            <input
              type="text"
              placeholder="ğŸ” æœç´¢æ±‰å­—æˆ–æ‹¼éŸ³... (Try 'æ¢¦' or 'mÃ¨')"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              onFocus={() => setShowList(true)}
              className="w-full pl-14 pr-4 py-4 rounded-2xl border-2 border-teal-100 focus:border-teal-500 focus:ring-4 focus:ring-teal-100 transition outline-none shadow-sm text-lg bg-white group-hover:shadow-md"
            />
            <div className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-teal-50 p-2 rounded-lg text-teal-500">
                <Search size={20} />
            </div>
          </div>

          {showList && searchTerm && (
            <div className="absolute top-full left-0 right-0 mt-3 bg-white rounded-2xl shadow-xl border border-gray-100 z-50 max-h-96 overflow-y-auto divide-y divide-gray-50">
              {filteredData.length > 0 ? (
                filteredData.map(item => (
                  <div 
                    key={item.id}
                    onClick={() => handleSelectChar(item)}
                    className="flex items-center justify-between p-4 hover:bg-teal-50 cursor-pointer transition-colors"
                  >
                    <div className="flex items-center gap-4">
                      <div className="w-10 h-10 rounded-lg bg-teal-100 text-teal-700 flex items-center justify-center text-2xl font-serif font-bold">
                        {item.char}
                      </div>
                      <div>
                        <div className="font-bold text-gray-800 flex items-center gap-2">
                            {item.pinyin}
                            {item.isCustom && <span className="text-[10px] bg-purple-100 text-purple-700 px-1.5 rounded border border-purple-200">è‡ªå®šä¹‰</span>}
                            {item.isRich && !item.isCustom && <span className="text-[10px] bg-amber-100 text-amber-700 px-1.5 rounded border border-amber-200">è¯¦è§£</span>}
                        </div>
                        <div className="text-xs text-gray-400 mt-0.5">Vol {item.volume} â€¢ Lesson {item.lesson} â€¢ {item.definition}</div>
                      </div>
                    </div>
                    <ChevronRight size={18} className="text-gray-300" />
                  </div>
                ))
              ) : (
                <div className="p-8 text-center text-gray-400 flex flex-col items-center gap-4">
                    <div className="text-4xl">ğŸ¤”</div>
                    <p>æœ¬åœ°æ²¡æœ‰æ‰¾åˆ° "{searchTerm}"</p>
                    
                    {searchTerm.length === 1 && /^[\u4e00-\u9fa5]$/.test(searchTerm) && (
                        <button 
                            onClick={() => fetchCharacterFromApi(searchTerm)}
                            disabled={isSearchingApi}
                            className="flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-2 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition transform disabled:opacity-70 disabled:cursor-not-allowed"
                        >
                            {isSearchingApi ? <Loader2 className="animate-spin" /> : <Cloud size={20} />}
                            ä½¿ç”¨ MXNZP äº‘ç«¯æœç´¢ "{searchTerm}"
                        </button>
                    )}
                </div>
              )}
            </div>
          )}
        </div>

        <div className="grid lg:grid-cols-12 gap-6">
          
          <div className="lg:col-span-5 flex flex-col gap-4">
              <div className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center justify-center min-h-[420px]">
                <div className="w-full flex justify-between items-center mb-6 px-2">
                    <h2 className="text-lg font-bold text-teal-800 flex items-center gap-2">
                        <div className="bg-teal-100 p-1.5 rounded text-teal-600">
                            <PenTool size={18} />
                        </div>
                        æ™ºèƒ½æçº¢
                    </h2>
                    <div className="text-xs font-mono font-medium text-gray-400 bg-gray-50 px-3 py-1 rounded-full border border-gray-100">
                        Lesson {selectedChar.lesson}
                    </div>
                </div>
            
                <HanziWriterBoard char={selectedChar.char} />
              </div>
          </div>

          <div className="lg:col-span-7 flex flex-col gap-6">
            
            <div className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 relative overflow-hidden">
                <div className="absolute top-0 right-0 w-32 h-32 bg-teal-50 rounded-bl-full -mr-8 -mt-8 z-0"></div>
                
                <div className="relative z-10 flex flex-col sm:flex-row justify-between items-start gap-4">
                    <div className="flex gap-6 items-center">
                        <div 
                            className="w-24 h-24 bg-teal-600 rounded-2xl flex items-center justify-center text-white text-6xl font-serif shadow-lg shadow-teal-200 cursor-pointer active:scale-95 transition"
                            onClick={() => speak(selectedChar.char)}
                        >
                            {selectedChar.char}
                        </div>
                        <div>
                            <div className="flex items-baseline gap-3 mb-1">
                                <h2 className="text-4xl font-bold text-gray-800">{selectedChar.pinyin}</h2>
                                <button onClick={() => speak(selectedChar.char)} className="text-teal-500 hover:text-teal-600 p-1 rounded-full hover:bg-teal-50">
                                    <Volume2 size={24} />
                                </button>
                            </div>
                            
                            {/* ä½¿ç”¨å¯æŠ˜å çš„é‡Šä¹‰ç»„ä»¶æ›¿ä»£åŸæœ‰çš„ <p> */}
                            <ExpandableDefinition text={selectedChar.definition} />

                            <div className="flex flex-wrap gap-2 mt-3">
                                <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-md font-medium border border-slate-200">
                                    ç»“æ„: {selectedChar.structure}
                                </span>
                                <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-md font-medium border border-slate-200">
                                    éƒ¨é¦–: {selectedChar.radical}
                                </span>
                                <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-md font-medium border border-slate-200">
                                    ç¬”ç”»: {selectedChar.strokes}
                                </span>
                            </div>
                        </div>
                    </div>
                    {selectedChar.isCustom && (
                        <button 
                            onClick={() => handleDeleteCustom(selectedChar.id)}
                            className="text-red-400 hover:text-red-600 p-2 bg-red-50 rounded-lg transition"
                            title="åˆ é™¤è‡ªå®šä¹‰ç”Ÿå­—"
                        >
                            <Trash2 size={18} />
                        </button>
                    )}
                </div>
            </div>

            <div className="bg-white rounded-3xl shadow-sm border border-gray-100 flex-1 flex flex-col">
                <div className="px-6 py-4 border-b border-gray-50 flex items-center justify-between">
                    <h3 className="font-bold text-gray-700 flex items-center gap-2">
                        <RefreshCcw size={18} className="text-amber-500" />
                        æ‰©å±•å­¦ä¹ 
                    </h3>
                    <div className="flex gap-2">
                        {selectedChar.isCustom && <span className="text-[10px] bg-purple-100 text-purple-600 px-2 py-1 rounded font-medium">ç”¨æˆ·è‡ªå®šä¹‰/API</span>}
                        {!selectedChar.isRich && !selectedChar.isCustom && <span className="text-[10px] bg-gray-100 text-gray-400 px-2 py-1 rounded">æš‚æ— è¯¦è§£ï¼Œè¯·è¡¥å……</span>}
                    </div>
                </div>

                <div className="p-6 grid sm:grid-cols-2 gap-8 flex-1">
                    <div className="space-y-4">
                        <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">å¸¸ç”¨è¯è¯­ Words</h4>
                        {selectedChar.words.map((word, i) => (
                            <div 
                                key={i} 
                                onClick={() => speak(word.split(' ')[0] || word)}
                                className="group flex items-center p-3 rounded-xl bg-slate-50 hover:bg-teal-50 border border-transparent hover:border-teal-100 cursor-pointer transition-all"
                            >
                                <div className="w-8 h-8 rounded-full bg-white text-teal-600 font-bold flex items-center justify-center text-sm shadow-sm mr-3 group-hover:scale-110 transition-transform">
                                    {i + 1}
                                </div>
                                <span className="text-gray-700 font-medium">{word}</span>
                                <Volume2 size={16} className="ml-auto text-teal-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                            </div>
                        ))}
                    </div>

                    <div className="space-y-4">
                        <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">ä¾‹å¥ Sentences</h4>
                        {selectedChar.sentences.map((sent, i) => (
                            <div 
                                key={i}
                                onClick={() => speak(sent)}
                                className="group relative p-4 rounded-xl bg-amber-50/50 hover:bg-amber-50 border border-amber-100/50 hover:border-amber-200 cursor-pointer transition-all"
                            >
                                <p className="text-gray-800 text-lg font-serif leading-relaxed">{sent}</p>
                                <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white p-1 rounded-full shadow-sm">
                                    <Volume2 size={14} className="text-amber-500" />
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>

          </div>
        </div>

        {/* åº•éƒ¨è¡¨å• */}
        <AddCharacterForm onAdd={handleAddCharacter} />

        <div className="text-center text-gray-400 text-sm py-4 pb-10">
          Â© 2023 Hanzi Learning App.
        </div>

      </main>
    </div>
  );
}